<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue- Rider's Dashboard</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Boxicons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../static/styles/home.css">
    <!-- Optionally, you can include your custom CSS file here -->
    <link href="../static/styles/riderauth.css" rel="stylesheet">
        <link rel="stylesheet" href="{{ url_for('static', filename='styles/ship.css') }}">

        <link rel="stylesheet" href="{{ url_for('static', filename='styles/sidebar.css') }}">
    <script src="../static/scripts/script.js"></script>
    <!-- Your sidebar content -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  </head>
  <body id="body-pd">
    <header class="header" id="header">
      <div class="header_toggle"> <i class='bx bx-menu' id="header-toggle"></i> </div>
      <div class="header_img"> <img src="https://i.imgur.com/hczKIze.jpg" alt=""> </div>
      <nav  id ="mainNavbar" class ="navbar navbar-dark  navbar-expand-md py-0 fixed-top">
	      <a href="{{ url_for('home') }}" class = "navbar-brand">VUE</a>
	      <button class = "navbar-toggler" data-toggle="collapse" data-target ="#navLinks">
		      <span class="navbar-toggler-icon"></span>
	      </button>
	      <div class ="collapse navbar-collapse" id="navLinks">
		      <ul class ="navbar-nav">
			      <li class ="nav-item">
				      <a href="{{ url_for('home') }}" class="nav-link">HOME</a>
			      </li>
			      <li class ="nav-item">
				      <a href="{{ url_for('about') }}" class="nav-link">ABOUT</a>
			      </li>
			      <li class ="nav-item">
				      <a href="{{ url_for('support') }}" class="nav-link">SUPPORT</a>
			      </li>
			      <li class ="nav-item">
				      <a href="#footer" class="nav-link">CONTACTS</a>
			      </li>
		      </ul>
	      </div>
      </nav>
    <div class="row justify-content-center">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                    {{ message }}
            </div>
            {% endfor %}
            {% endif %}
            {% endwith %}

    </div>
    </header>
    <div class="l-navbar" id="nav-bar">
      <nav class="nav">
        <div> 
          <a href="#" class="nav_logo"> 
            <i class='bx bx-layer nav_logo-icon'>
            </i><span class="nav_logo-name">BBBootstrap</span> 
          </a>
          <div class="nav_list"> 
		  <a href="#" class="nav_link active"> <i class='bx bx-grid-alt nav_icon'></i> <span class="nav_name">Dashboard</span> </a> 
            <a href="#" class="nav_link"> <i class='bx bx-user nav_icon'></i> <span class="nav_name">Users</span> </a> 
            <a href="{{ url_for('edit_rider_profile') }}" class="nav_link"> <i class='bx bx-message-square-detail nav_icon'></i> <span class="nav_name">My profile</span> </a> 
            <a href="{{ url_for('edit_rider_profile') }}" class="nav_link"> <i class='bx bx-bookmark nav_icon'></i> <span class="nav_name">Update status</span> </a> 
            <a href="{{ url_for('support') }}" class="nav_link"> <i class='bx bx-folder nav_icon'></i> <span class="nav_name">Support</span> </a> 
            <a href="{{ url_for('view_rider_history') }}" class="nav_link"> <i class='bx bx-bar-chart-alt-2 nav_icon'></i> <span class="nav_name">View my History</span> </a> </div>
        </div> <a href="{{ url_for('logout') }}" class="nav_link"> <i class='bx bx-log-out nav_icon'></i> <span class="nav_name">SignOut</span> </a>
      </nav>
    </div>
<div class="assyn">
    <h1 class="heading">Pending Delivery Assignments</h1>

    {% if assignment %}
        <ul class="assignment-list">
            <li class="assignment-item">
                <p class="assignment-info"><strong>Sender:</strong> {{ assignment.sender_name }}</p>
                <p class="assignment-info"><strong>Pickup Location:</strong> {{ assignment.pickup_location }}</p>
                <p class="assignment-info"><strong>Delivery Location:</strong> {{ assignment.delivery_location }}</p>
                <p class="assignment-info"><strong>Description:</strong> {{ assignment.description }}</p>
                <div class="action-buttons">
                    <button class="accept-btn" data-id="{{ assignment.id }}">Accept</button>
                    <button class="deny-btn" data-id="{{ assignment.id }}">Deny</button>
                </div>
            </li>
        </ul>
    {% else %}
        <p class="no-assignments">No pending assignments.</p>
    {% endif %}
</div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to accept and deny buttons
            document.querySelectorAll('.accept-btn').forEach(function(button) {
                button.addEventListener('click', function() {
                    handleAction(button.dataset.id, 'accept');
                });
            });

            document.querySelectorAll('.deny-btn').forEach(function(button) {
                button.addEventListener('click', function() {
                    handleAction(button.dataset.id, 'deny');
                });
            });

            // Function to handle action (accept or deny) for an assignment
            function handleAction(parcelId, action) {
                // Send AJAX request to update assignment status
                fetch('/update_assignment', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        parcel_id: parcelId,
                        action: action,
                    }),
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to update assignment');
                    }
                })
                .then(data => {
                    // Handle success response
                    if (data.success) {
                        // Reload the page or update UI as needed
                        location.reload();
                    } else {
                        // Handle error response
                        console.error(data.error);
                    }
                })
                .catch(error => {
                    // Handle fetch errors
                    console.error('Error:', error);
                });
            }
        });
    </script>
    <script>
      function loadContent(page) {
        fetch(page)
          .then(response => response.text())
          .then(data => {
            document.getElementById('main-content').innerHTML = data;
          })
          .catch(error => console.error('Error loading page:', error));
      }
    </script>
  </body>
</html>
